<!DOCTYPE html>
<html lang="en-us" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Sourcebuster Js -->
    <script src="https://cdn.jsdelivr.net/npm/sourcebuster@1.1.0/dist/sourcebuster.min.js"  crossorigin="anonymous"></script>

    <!-- Ajax Js -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" crossorigin="anonymous"></script>

    <!-- Required meta tags: Universal Character Set + Transformation Format—8-bit -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- APP | PAGE NAME -->
    <title>User Portal | Update</title>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> -->

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

</head>
<body onload="updateDB();">
    <div class="container">

        <!-- form info / Home link-->
        <div class="text-center">
            <h2>User Portal</h2>
            <a href="/adminstrator/users" class="btn col-sm-2"><strong>Home</strong></a>
        </div>
        <style>
            a.btn {
                width: 150px;
                padding: 10px;
                cursor: pointer;
                font-weight: bold;
                font-size: 80%;
                background: deepskyblue;
                color: #fff;
                border: deepskyblue;
                border-radius: 10px;
            }
            a.btn:hover {
                color: black;
                background: deepskyblue;
                border: deepskyblue;
            }
        </style>

        <form class="form-horizontal" th:object="${registrationForm}" th:action="@{/adminstrator}" method="post">

            <form class="form-horizontal" th:object="${registrationForm}" th:action="@{/interactions}" method="get" enctype="text/plain">

                <input type="hidden" th:field="*{id}"/>
                <input type="hidden" th:field="*{dateCreated}"/>

                <div class="form-group" th:class="${#fields.hasErrors('title')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="text" id="title" name="title" class="form-control"
                           placeholder="Title" th:field="*{title}" th:errorclass="has-error" onblur="myFunction()" value=""required="required"/>
                    <p class="errorDiv" id="interactionsTitle"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('lastname')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="text" id="lastname" name="lastname" class="form-control"
                           placeholder="Surname" th:field="*{lastname}" th:errorclass="has-error" onblur="myFunction()" value="" required="required"/>
                    <p class="errorDiv" id="interactionsLastname"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('firstname')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="text" id="firstname" name="firstname" class="form-control"
                           placeholder="First name" th:field="*{firstname}" th:errorclass="has-error" onblur="myFunction()" value="" required="required"/>
                    <p id="interactionsFirstname"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('phoneNumber')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="number" id="phoneNumber" name="phoneNumber" max="50000000000" step="0" class="form-control"
                           placeholder="Telephone" th:field="*{phoneNumber}" th:errorclass="has-error" onblur="myFunction()" value="" required="required"/>
                    <p id="interactionsPhoneNumber"></p>
                </div>

<!--                            <div class="form-group" th:class="${#fields.hasErrors('dateOfBirth')} ? 'form-group has-error' : 'form-group'">-->
<!--                                <label class="control-label"></label>-->
<!--                                <input type="date" id="dateOfBirth" name="dateOfBirth"class="form-control" th:field="*{dateOfBirth}"-->
<!--                                       th:errorclass="has-error" onblur="myFunction()" required="required" onclick="hideErrorMessage()"-->
<!--                                       value="2018-01-10" min="1930-01-01" max="2100-12-31">-->
<!--                                <p id="interactionsDateOfBirth"></p>-->
<!--                            </div>-->

                <div class="form-group" th:class="${#fields.hasErrors('gender')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="text" id="gender" name="gender" class="form-control"
                           placeholder="Gender" th:field="*{gender}" th:errorclass="has-error" onblur="myFunction()" value="" required="required"/>
                    <p id="interactionsGender"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('username')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="text" id="username" name="username" class="form-control"
                           placeholder="Username" th:field="*{username}" th:errorclass="has-error" onblur="myFunction()" value="" required="required"/>
                    <p id="interactionsUsername"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('email')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="email" id="email" name="email" placeholder="Enter email" class="form-control"
                           th:field="*{email}" th:errorclass="has-error" onblur="myFunction()" value=""/>
                    <p id="interactionsEmail"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('password')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="password" id="password" name="password" placeholder="Create password" class="form-control"
                           th:field="*{password}" th:errorclass="has-error" onblur="myFunction()" value=""/>
                    <p id="interactionsPassword"></p>
                </div>

                <div class="form-group" th:class="${#fields.hasErrors('passwordSalt')} ? 'form-group has-error' : 'form-group'">
                    <label class="control-label"></label>
                    <input type="password" id="passwordSalt" name="passwordSalt" placeholder="Confirm password" class="form-control"
                           th:field="*{passwordSalt}" th:errorclass="has-error" onblur="myFunction()" value=""/>
                    <p id="interactionsPasswordSalt"></p>
                </div>

                <div class="text-center">
                    <button id="submit" class="submit" type="submit">Submit</button>
                </div>
                <style>
                    button.submit {
                        width: 150px;
                        padding: 10px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 80%;
                        background: deepskyblue;
                        color: #fff;
                        border: deepskyblue;
                        border-radius: 10px;
                    }
                    button.submit:hover {
                        color: black;
                        background: deepskyblue;
                        border: deepskyblue;
                    }
                </style>
            </form>
        </form>
        <p>
        <footer class="form-group site-footer">
            <div class="site-footer-legal">© 2019
                <a href="www.travelbeta.com">Travelbeta</a>
            </div>
            <div class="form-group site-footer-right">
                <div class="form-group site-footer-right">
                    Powered by <a href="www.travelbeta.com">Travelbeta.com Limited </a>
                </div>
            </div>
        </footer>
    </div>
    <!--
        On-Load Events Function
    -->
    <script type="text/javascript">
        $(document).ready(function() {

            $(function updateDB() {
                $.ajax({
                    success: function() {
                        console.log("Update Portal Page: Loaded");
                    }
                });
            });
        });
    </script>
    <!--
        Password Validation
    -->
    <script>
        var password = document.getElementById("password")
            , passwordSalt = document.getElementById("passwordSalt");

        function validatePassword(){
            if(password.value !== passwordSalt.value) {
                passwordSalt.setCustomValidity("Passwords Don't Match");
            } else {
                passwordSalt.setCustomValidity('');
            }
        }

        password.onchange = validatePassword;
        passwordSalt.onkeyup = validatePassword;
    </script>
    <!--
        On-Blur Events Function + JQuery Ajax Call
    -->
    <script type="text/javascript">
        // var changeTimer = false;

        $("#title").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Surname...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { title: val },
                success: function() {
                    console.log('Title: ' + val);

                }
            });
        });
        $("#firstname").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Surname...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { firstname: val },
                success: function() {
                    console.log('Surname: ' + val);

                }
            });
        });
        $("#lastname").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Last Name...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { lastname: val },
                success: function() {
                    console.log('Last Name: ' + val);
                }
            });
        });
        $("#phoneNumber").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Telephone Number...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { phoneNumber: val },
                success: function() {
                    console.log('Telephone: ' + val);
                }
            });
        });
        $("#dateOfBirth").blur(function myFunction() {
            var val = $(this).val();
            console.log("Changing Date-of-Birth...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { dateOfBirth: val },
                success: function() {
                    console.log('D.o.B: ' + val);
                }
            });
        });
        $("#gender").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Gender Status...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { gender: val },
                success: function() {
                    console.log('Gender: ' + val);
                }
            });
        });
        $("#username").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Username...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { username: val },
                success: function() {
                    console.log('Username: ' + val);
                }
            });
        });
        $("#email").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Email Address...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { email: val },
                success: function() {
                    console.log('Email Address: ' + val);
                }
            });
        });
        $("#password").blur(function myFunction() {
            var val = $(this).val();
            console.log("Updating Password...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { password: val },
                success: function() {
                    console.log('Password: ' + val);
                }
            });
        });
        $("#passwordSalt").blur(function myFunction() {
            var val = $(this).val();
            console.log("Confirming Password...");

            $.ajax({
                type: "GET",
                url: "/interactions",
                data: { password: val },
                // data: { passwordSalt: val },
                success: function() {
                    console.log('Password Confirmed: ' + val);
                }
            });
        });

        // $("#passWord").blur(function myFunction() {
        //     var val = $(this).val();
        //     console.log("Updating Password...");
        //
        //     if(changeTimer !== false) clearTimeout(changeTimer);
        //     changeTimer = setTimeout(function(){
        //
        //         $.ajax({
        //             type: "GET",
        //             url: "/interactions",
        //             data: { passWord: val },
        //             success: function() {
        //                 console.log('Password: ' + val);
        //             }
        //         });
        //         changeTimer = false;
        //     },300);
        // });
    </script>
    <!--
        On-Blur Function
    -->
    <script type="text/javascript">
        function myFunction() {
            var ajaxRequest;
            if (window.XMLHttpRequest) {
                ajaxRequest = new XMLHttpRequest();
            } else {
                ajaxRequest = new ActiveXObject("Microsoft.XMLHttpRequest");
            }

            ajaxRequest.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {

                    var title = document.getElementById("title").value;
                    document.getElementById("interactionsTitle").innerHTML = "You wrote: " + title;

                    var firstname = document.getElementById("firstname").value;
                    document.getElementById("interactionsFirstname").innerHTML = "You wrote: " + firstname;

                    var lastname = document.getElementById("lastname").value;
                    document.getElementById("interactionsLastname").innerHTML = "You wrote: " + lastname;

                    var telephone = document.getElementById("phoneNumber").value;
                    document.getElementById("interactionsPhoneNumber").innerHTML = "You wrote: " + telephone;

                    // var dateOfBirth = document.getElementById("dateOfBirth").value;
                    // document.getElementById("interactionsDateOfBirth").innerHTML = "You wrote: " + dateOfBirth;

                    var gender = document.getElementById("gender").value;
                    document.getElementById("interactionsGender").innerHTML = "You wrote: " + gender;

                    var username = document.getElementById("username").value;
                    document.getElementById("interactionsUsername").innerHTML = "You wrote: " + username;

                    var email = document.getElementById("email").value;
                    document.getElementById("interactionsEmail").innerHTML = "You wrote: " + email;

                    var password = document.getElementById("password").value;
                    document.getElementById("interactionsPassword").innerHTML = "You wrote: " + password;

                    var passwordSalt = document.getElementById("passwordSalt").value;
                    document.getElementById("interactionsPasswordSalt").innerHTML = "You wrote: " + passwordSalt;
                }
            };

            ajaxRequest.open("GET", "/interactions", true);
        }
    </script>
</body>
    <!--
        On-Load Function
    -->
    <script>
        function updateDB() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/adminstrator.htm", true);
        }
    </script>
</html>


<!--            <div id="errorDiv" class="text-center alert-danger">-->
<!--                <div th:if="${#fields.hasErrors('*')}">-->
<!--                    <p th:text="#{form.hasErrors}">-->
<!--                        <div class="alert alert-info text-center" style="font-size: 1.4334em" th:text="${message}"></div>-->
<!--                        <span class="close"></span>-->
<!--                    </p>-->
<!--                </div>-->
<!--            </div>-->